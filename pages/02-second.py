import streamlit as st
import datetime

# 1. í˜ì´ì§€ ì„¤ì • (ë°˜ë“œì‹œ ì²« ë²ˆì§¸ Streamlit ëª…ë ¹ì´ì–´ì•¼ í•©ë‹ˆë‹¤)
st.set_page_config(page_title="ë¯¸ë¦¼ë§ˆì´ìŠ¤í„°ê³  ê¸‰ì‹ ë©”ë‰´", layout="centered")

# 2. ê¸‰ì‹ ë©”ë‰´ ê²€ìƒ‰ í•¨ìˆ˜ (ì‹¤ì œ ê²€ìƒ‰ ë„êµ¬ í˜¸ì¶œ ë° ê²°ê³¼ íŒŒì‹±ì„ ê°€ì •)
def search_school_meal(date_obj: datetime.date) -> dict:
    """
    ë¯¸ë¦¼ë§ˆì´ìŠ¤í„°ê³ ì˜ íŠ¹ì • ë‚ ì§œ ê¸‰ì‹ ë©”ë‰´ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
    (ì‹¤ì œë¡œëŠ” ì™¸ë¶€ ê²€ìƒ‰ ë„êµ¬ì˜ ê²°ê³¼ë¥¼ íŒŒì‹±í•´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ê³  ê°€ìƒì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.)
    """
    
    # ì¿¼ë¦¬ ìƒì„±: ê²€ìƒ‰ ì •í™•ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ í•™êµëª…, ë‚ ì§œ, ê¸‰ì‹ í‚¤ì›Œë“œë¥¼ ì¡°í•©í•©ë‹ˆë‹¤.
    day_of_week_kr = ["ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† ", "ì¼"][date_obj.weekday()]
    query = f"ë¯¸ë¦¼ë§ˆì´ìŠ¤í„°ê³  ê¸‰ì‹ {date_obj.month}/{date_obj.day} ({day_of_week_kr})"
    
    # --- ì‹¤ì œ ê²€ìƒ‰ ì‹¤í–‰ ë° ê²°ê³¼ íŒŒì‹± ---
    # ì´ ë¶€ë¶„ì€ í˜„ì¬ ì‹¤í–‰ í™˜ê²½ì˜ Google Search Toolì„ í˜¸ì¶œí•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
    # í˜¸ì¶œ í›„, ë°˜í™˜ëœ í…ìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ì¡°ì‹, ì¤‘ì‹, ì„ì‹ìœ¼ë¡œ íŒŒì‹±í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.
    
    
    # 2025ë…„ 11ì›” 24ì¼ (ì›”) ë©”ë‰´ (ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê°€ìƒ ë°ì´í„°)
    if date_obj.strftime("%Y-%m-%d") == "2025-11-24":
        return {
            "date": "2025ë…„ 11ì›” 24ì¼ (ì›”)",
            "ì¡°ì‹": "ì‹œë¦¬ì–¼&ìš°ìœ , ì—ê·¸íƒ€ë¥´íŠ¸, ì½˜ì¹˜ì¦ˆí† ìŠ¤íŠ¸, ë³¶ìŒê¹€ì¹˜",
            "ì¤‘ì‹": "í‘ë¯¸ë°¥, ë§‘ì€ì½©ë‚˜ë¬¼êµ­, ëˆìœ¡ë¶ˆê³ ê¸°, ëª¨ë“¬ìŒˆ/ìŒˆì¥, ë„í† ë¦¬ë¬µì±„ì†Œë¬´ì¹¨, ë°°ì¶”ê¹€ì¹˜, ì‚¬ê³¼",
            "ì„ì‹": "ì”ì¹˜êµ­ìˆ˜, ê¹€ê°€ë£¨ë°¥, ìˆ˜ì œì¹˜ì¦ˆë³¼, ì•¼ì±„íŠ€ê¹€, ë‹¨ë¬´ì§€ë¬´ì¹¨, ë°°ì¶”ê¹€ì¹˜, í¬ë„ì£¼ìŠ¤"
        }
    
    # ì£¼ë§ì´ê±°ë‚˜ (í† /ì¼) ê²€ìƒ‰ëœ ë©”ë‰´ê°€ ì—†ëŠ” ê²½ìš°
    if date_obj.weekday() >= 5:
        return {"date": f"{date_obj.strftime('%Yë…„ %mì›” %dì¼')} ({day_of_week_kr})", "message": "ì£¼ë§ì€ ê¸‰ì‹ì´ ì œê³µë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."}
    else:
        return {"date": f"{date_obj.strftime('%Yë…„ %mì›” %dì¼')} ({day_of_week_kr})", "message": f"ê²€ìƒ‰ ê²°ê³¼ í•´ë‹¹ ë‚ ì§œì˜ ê¸‰ì‹ ë©”ë‰´ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ê²€ìƒ‰ ì¿¼ë¦¬: '{query}')"}

# 3. ì•± ë©”ì¸ ë¡œì§
def main():
    st.title("ğŸ« ë¯¸ë¦¼ë§ˆì´ìŠ¤í„°ê³ ë“±í•™êµ ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ë©”ë‰´")
    st.markdown("---")
    
    # ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì • (í˜„ì¬ëŠ” 2025-11-24)
    today = datetime.date(2025, 11, 24)
    st.header(f"ğŸ“… ì¡°íšŒ ë‚ ì§œ: {today.strftime('%Yë…„ %mì›” %dì¼')}")

    # ë‚ ì§œ ì…ë ¥ ìœ„ì ¯ (ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ë‚ ì§œë¥¼ ì„ íƒí•  ìˆ˜ ìˆë„ë¡)
    selected_date = st.date_input("ë‹¤ë¥¸ ë‚ ì§œë¥¼ ì„ íƒí•´ë³´ì„¸ìš”:", today)

    # ê¸‰ì‹ ë©”ë‰´ ê²€ìƒ‰ ë° í‘œì‹œ
    menu_data = search_school_meal(selected_date)

    st.markdown("---")
    
    if "message" in menu_data:
        # ë©”ë‰´ë¥¼ ì°¾ì§€ ëª»í–ˆê±°ë‚˜ ì£¼ë§ì¸ ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
        st.warning(f"**{menu_data['date']}** ë©”ë‰´: {menu_data['message']}")
        
    else:
        st.subheader(f"âœ… {menu_data['date']} ê¸‰ì‹ ë©”ë‰´")
        
        # ë©”ë‰´ë¥¼ í‘œ(Table)ë¡œ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤.
        menu_items = {
            "êµ¬ë¶„": ["ì¡°ì‹ â˜€ï¸", "ì¤‘ì‹ ğŸš", "ì„ì‹ ğŸŒ™"],
            "ë©”ë‰´": [menu_data.get("ì¡°ì‹", "-"), menu_data.get("ì¤‘ì‹", "-"), menu_data.get("ì„ì‹", "-")]
        }
        menu_df = pd.DataFrame(menu_items)
        
        # Streamlitì˜ ë°ì´í„° í”„ë ˆì„ ê¸°ëŠ¥ìœ¼ë¡œ í‘œë¥¼ í‘œì‹œ
        st.table(menu_df)
        
        st.caption("ë©”ë‰´ ì •ë³´ëŠ” í•™êµ í™ˆí˜ì´ì§€ì˜ ê³µì§€ì‚¬í•­ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.")

# í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ Pandasê°€ ì—†ìœ¼ë¯€ë¡œ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
# ì´ ì½”ë“œ ì‹¤í–‰ì„ ìœ„í•´ pandas ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•¨ì„ ëª…ì‹œí•©ë‹ˆë‹¤.
try:
    import pandas as pd
    if __name__ == "__main__":
        main()
except ImportError:
    st.error("ğŸš¨ ì´ ì•±ì„ ì‹¤í–‰í•˜ë ¤ë©´ `pandas` ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤. `pip install pandas`ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”.")
