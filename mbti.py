import streamlit as st
import pandas as pd
import numpy as np
import io

# 1. MBTI ìœ í˜•ë³„ ê°„ë‹¨í•œ ì„¤ëª… ë°ì´í„° (í•˜ë“œì½”ë”©)
MBTI_DESCRIPTIONS = {
    'ISTJ': "ì„¸ìƒì˜ ì†Œê¸ˆí˜•: í˜„ì‹¤ì ì´ê³  ì‚¬ì‹¤ì ì´ë©° ë…¼ë¦¬ì ì…ë‹ˆë‹¤. ì±…ì„ê°ì´ ê°•í•©ë‹ˆë‹¤.",
    'ISFJ': "ìš©ê°í•œ ìˆ˜í˜¸ì: ì¡°ìš©í•˜ê³  í—Œì‹ ì ì´ë©° ì±…ì„ê°ì´ ê°•í•©ë‹ˆë‹¤. ì‚¬ë ¤ ê¹ŠìŠµë‹ˆë‹¤.",
    'INFJ': "ì„ ì˜ì˜ ì˜¹í˜¸ì: í†µì°°ë ¥ì´ ë›°ì–´ë‚˜ê³  ì´ìƒì ì¸ ì„¸ìƒì„ ê¿ˆê¿‰ë‹ˆë‹¤. ì¸ë¥˜ì• ê°€ ìˆìŠµë‹ˆë‹¤.",
    'INTJ': "ì „ëµê°€: ë…ë¦½ì ì´ê³  ë¶„ì„ì ì…ë‹ˆë‹¤. ëª¨ë“  ì¼ì— ê³„íšì„ ì„¸ì›ë‹ˆë‹¤.",
    'ISTP': "ë§ŒëŠ¥ ì¬ì£¼ê¾¼: ì¡°ìš©í•˜ê³  ê³¼ë¬µí•˜ë©°, ë…¼ë¦¬ì ì´ê³  ë¶„ì„ì ì…ë‹ˆë‹¤. ê¸°ê³„ë¥¼ ì˜ ë‹¤ë£¹ë‹ˆë‹¤.",
    'ISFP': "í˜¸ê¸°ì‹¬ ë§ì€ ì˜ˆìˆ ê°€: ë”°ëœ»í•˜ê³  ìœ ì—°í•˜ë©° í˜¸ê¸°ì‹¬ì´ ë§ìŠµë‹ˆë‹¤. ì˜ˆìˆ ì  ê°ê°ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.",
    'INFP': "ì—´ì •ì ì¸ ì¤‘ì¬ì: ì°½ì˜ì ì´ê³  ì‚¬ë ¤ ê¹ŠìŠµë‹ˆë‹¤. ìì‹ ì˜ ê°€ì¹˜ê´€ì— ì¶©ì‹¤í•©ë‹ˆë‹¤.",
    'INTP': "ë…¼ë¦¬ì ì¸ ì‚¬ìƒ‰ê°€: ì§€ì ì¸ í˜¸ê¸°ì‹¬ì´ ë§ê³  ë¹„íŒì  ì‚¬ê³  ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.",
    'ESTP': "ëª¨í—˜ì„ ì¦ê¸°ëŠ” ì‚¬ì—…ê°€: í™œë™ì ì´ê³  ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤. ì¦‰í¥ì ì…ë‹ˆë‹¤.",
    'ESFP': "ììœ ë¡œìš´ ì˜í˜¼ì˜ ì—°ì˜ˆì¸: ë„˜ì¹˜ëŠ” ì—ë„ˆì§€ë¥¼ ê°€ì§„ ììœ ë¡œìš´ ì˜í˜¼ì…ë‹ˆë‹¤. ì‚¬êµì ì…ë‹ˆë‹¤.",
    'ENFP': "ì¬ê¸° ë°œë„í•œ í™œë™ê°€: ì—´ì •ì ì´ê³  ì°½ì˜ì ì…ë‹ˆë‹¤. ìƒìƒë ¥ì´ í’ë¶€í•©ë‹ˆë‹¤.",
    'ENTP': "ë³€ë¡ ê°€: ë˜‘ë˜‘í•˜ê³  ë„ì „ì ì´ë©° ì§€ì ì¸ ë„ì „ì„ ì¦ê¹ë‹ˆë‹¤. ë…¼ìŸì„ ì¦ê¹ë‹ˆë‹¤.",
    'ESTJ': "ì‚¬ì—…ê°€: ì²´ê³„ì ì´ê³  ë¦¬ë”ì‹­ì´ ìˆìŠµë‹ˆë‹¤. í˜„ì‹¤ì ì´ë©° ì¡°ì§ì ì…ë‹ˆë‹¤.",
    'ESFJ': "ì‚¬êµì ì¸ ì™¸êµê´€: ì¹œì ˆí•˜ê³  ì‚¬êµì ì…ë‹ˆë‹¤. ì‚¬ëŒë“¤ì„ ë•ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤.",
    'ENFJ': "ì •ì˜ë¡œìš´ ì‚¬íšŒìš´ë™ê°€: ì¹´ë¦¬ìŠ¤ë§ˆ ìˆê³  ì´íƒ€ì ì…ë‹ˆë‹¤. ì‚¬ëŒë“¤ì˜ ì„±ì¥ì— ê¸°ì—¬í•©ë‹ˆë‹¤.",
    'ENTJ': "ëŒ€ë‹´í•œ í†µì†”ì: ëŒ€ë‹´í•˜ê³  í†µì†”ë ¥ì´ ìˆìŠµë‹ˆë‹¤. ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ê³„íšì„ ì„¸ì›ë‹ˆë‹¤."
}

# 2. ë©˜íŠ¸ ìƒì„± í•¨ìˆ˜
def generate_compliment(mbti, percentage):
    """
    MBTI ìœ í˜•ê³¼ í†µê³„ ë¹„ìœ¨ì„ ê¸°ë°˜ìœ¼ë¡œ ê²©ë ¤ ë° íŠ¹ì§• ë©˜íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    """
    trait = MBTI_DESCRIPTIONS.get(mbti, "").split(':')[0].strip()
    
    # ë©˜íŠ¸ íŒ¨í„´
    if percentage >= 10:
        stat_msg = "ê°€ì¥ í”í•œ ìœ í˜• ì¤‘ í•˜ë‚˜"
        stat_adj = "ë§ì€ ì‚¬ëŒë“¤ê³¼ ê³µê°ëŒ€ë¥¼ í˜•ì„±í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤"
    elif percentage >= 5:
        stat_msg = "ë¹„êµì  í”í•œ ìœ í˜•"
        stat_adj = "ì£¼ë³€ì—ì„œ ì‰½ê²Œ ì°¾ì•„ë³¼ ìˆ˜ ìˆì–´ ì ì‘ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤"
    else:
        stat_msg = "í¬ê·€í•œ í¸ì— ì†í•˜ëŠ” íŠ¹ë³„í•œ ìœ í˜•"
        stat_adj = "ë‹¹ì‹ ë§Œì˜ ê³ ìœ í•œ ê´€ì ê³¼ ê°•ì ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤"

    compliment = (
        f"**âœ¨ {mbti} ìœ í˜•ì´ì‹  ë‹¹ì‹ **ì€ **{trait}** ë¶„ì´ì‹œêµ°ìš”! "
        f"ì „ ì„¸ê³„ í‰ê·  ì¸êµ¬ì˜ ì•½ **{percentage:.1f}%**ë¥¼ ì°¨ì§€í•˜ëŠ” **{stat_msg}**ì…ë‹ˆë‹¤. "
        f"ì´ëŸ¬í•œ ë¹„ìœ¨ì€ ë‹¹ì‹ ì´ {stat_adj}ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. "
        f"ë‹¹ì‹ ì˜ ê³ ìœ í•œ ê°•ì ì„ ë§ˆìŒê» í¼ì³ë‚˜ê°€ì‹œê¸¸ ì‘ì›í•©ë‹ˆë‹¤! ğŸš€"
    )
    return compliment

# 3. Streamlit ì•± ë©”ì¸ í•¨ìˆ˜
def main():
    st.set_page_config(page_title="MBTI ì„±ê²© ìœ í˜• ë¶„ì„ê¸°", layout="centered")
    
    st.title("ğŸ§© MBTI ì„±ê²© ìœ í˜• ë¶„ì„ê¸°")
    st.markdown("---")

    # ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ
    if 'mbti_df' not in st.session_state:
        # íŒŒì¼ ë‚´ìš©ì„ ì§ì ‘ ì½ì–´ DataFrameìœ¼ë¡œ ë³€í™˜
        try:
            # contentFetchIdë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ì ‘ê·¼
            file_path = "countriesMBTI_16types.csv"
            df = pd.read_csv(file_path)

            # ì²« ë²ˆì§¸ ì»¬ëŸ¼(Country)ì„ ì¸ë±ìŠ¤ë¡œ ì„¤ì •
            df.set_index(df.columns
